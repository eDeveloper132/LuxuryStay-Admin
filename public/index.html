<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LuxuryStay Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <script>
    // If not logged in, go to login
    if (!localStorage.getItem('token')) {
      window.location.href = '/login';
    }
  </script>
  <!-- Header -->
  <header class="bg-white shadow px-4 py-3 flex items-center justify-between">
    <h1 class="text-xl sm:text-2xl font-bold text-blue-600">LuxuryStay Admin</h1>
    <div class="lg:hidden">
      <button id="menuToggle" class="text-blue-600 focus:outline-none">
        â˜°
      </button>
    </div>
    <a id="logout" class="hidden sm:inline text-red-500 hover:underline">Logout</a>
  </header>

  <!-- Layout -->
  <div class="flex flex-1 overflow-hidden">
    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 bg-white shadow-md p-4 hidden lg:block transition-all duration-300 ease-in-out">
      <h2 class="text-xl font-bold text-blue-600 mb-6">Admin Panel</h2>
      <nav class="space-y-2">
        <a href="/" class="block py-2 px-4 rounded hover:bg-blue-100 text-gray-700">ğŸ“Š Dashboard</a>
        <a href="/users" class="block py-2 px-4 rounded hover:bg-blue-100 text-gray-700">ğŸ‘¥ Add / Update Users</a>
        <a href="/bookings" class="block py-2 px-4 rounded hover:bg-blue-100 text-gray-700">ğŸ“– Booking Details</a>
        <a href="/rooms" class="block py-2 px-4 rounded hover:bg-blue-100 text-gray-700">ğŸ›ï¸ All Rooms</a>
        <a href="/rooms/manage" class="block py-2 px-4 rounded hover:bg-blue-100 text-gray-700">ğŸ› ï¸ Manage Rooms</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-4 sm:p-6 overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Dashboard</h2>
        <a href="/api/auth/signout" class="lg:hidden text-red-500 hover:underline text-sm">Logout</a>
      </div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Card Template -->
        <div class="bg-white p-5 rounded-xl shadow flex items-center gap-4">
          <div class="flex-1">
            <p class="text-sm text-gray-500">Total Rooms</p>
            <p id="totalRooms" class="text-2xl font-bold">â€”</p>
          </div>
          <svg class="w-10 h-10 text-blue-300" fill="currentColor" viewBox="0 0 20 20">
            <path d="M4 3h12v2H4V3zm0 4h12v2H4V7zm0 4h12v2H4v-2zm0 4h12v2H4v-2z" />
          </svg>
        </div>

        <div class="bg-white p-5 rounded-xl shadow flex items-center gap-4">
          <div class="flex-1">
            <p class="text-sm text-gray-500">Occupied</p>
            <p id="occupiedRooms" class="text-2xl font-bold">â€”</p>
          </div>
          <svg class="w-10 h-10 text-red-300" fill="currentColor" viewBox="0 0 20 20">
            <path d="M5 3v12h10V3H5zm2 2h6v8H7V5z" />
          </svg>
        </div>

        <div class="bg-white p-5 rounded-xl shadow flex items-center gap-4">
          <div class="flex-1">
            <p class="text-sm text-gray-500">Today's Bookings</p>
            <p id="todaysBookings" class="text-2xl font-bold">â€”</p>
          </div>
          <svg class="w-10 h-10 text-green-300" fill="currentColor" viewBox="0 0 20 20">
            <path d="M6 2v2H4v2h2v8H4v2h2v2h4v-2h2v-2H8V6h2V4H8V2H6z" />
          </svg>
        </div>

        <div class="bg-white p-5 rounded-xl shadow flex items-center gap-4">
          <div class="flex-1">
            <p class="text-sm text-gray-500">Revenue</p>
            <p id="revenue" class="text-2xl font-bold">â€”</p>
          </div>
          <svg class="w-10 h-10 text-yellow-300" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 2a8 8 0 100 16 8 8 0 000-16zm1 12H9v-2h2v2zm0-4H9V6h2v4z" />
          </svg>
        </div>
      </div>
    </main>
  </div>

  <!-- Footer -->
  <footer class="bg-white text-center p-4 text-sm text-gray-500">
    &copy; 2025 LuxuryStay Hospitality
  </footer>

  <!-- JS Scripts -->
  <script>
    // Toggle sidebar
    document.getElementById('logout')?.addEventListener('click', () => {
      localStorage.clear();
      window.location.href = '/login';
    });
    document.getElementById('menuToggle')?.addEventListener('click', () => {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('hidden');
    });

    // Fetch stats
    fetch('http://localhost:3001/api/stats', {
      headers: {
        Authorization: `Bearer ${localStorage.getItem('token')}`
      }
    })
      .then(res => res.json())
      .then(data => {
        document.getElementById('totalRooms').textContent = data.totalRooms ?? 'â€”';
        document.getElementById('occupiedRooms').textContent = data.occupied ?? 'â€”';
        document.getElementById('todaysBookings').textContent = data.todaysBookings ?? 'â€”';
        document.getElementById('revenue').textContent = '$' + (data.revenue ?? '0');
      })
      .catch(err => {
        console.error('Stats fetch failed:', err);
      });

    // Socket handlers
    const adminSocket = window.adminSocket;
    if (adminSocket) {
      adminSocket.onBookingCreated(data => {
        const badge = document.getElementById('bookingBadge');
        if (badge) badge.textContent = String(Number(badge.textContent || '0') + 1);
      });

      adminSocket.onInvoiceGenerated(data => {
        alert(`ğŸ§¾ New invoice for $${data.amount} generated!`);
      });
    }
  </script>
  <script src="./js/adminSocket.js"></script>
</body>
</html>
